@{
    ViewData["Title"] = "Home Page";
}

    <form asp-controller="Home" asp-action="DownloadVideo" method="post">

        @Html.TextBox("videoUrl", "", new { placeholder = "Enter URL here.", @class = "form-control" })
        <br />
        <button id="btnDownload" type="submit" class="btn btn-danger btn-block">Download <i class="fas fa-download"></i></button>

        <div style="display:inline-block; margin-top: 25px; margin-bottom: 40px;">
            <div id="spiner" class="spinner-border text-danger" style="position: absolute; margin-left: auto; margin-right: auto; left: 0; right: 0;">
                <span class="sr-only">Loading...</span>
            </div>
        </div>

        @if (@ViewBag.successDownload)
        {
            @Html.Partial("_StatusMessages")
        }
    </form>

        <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
        <div class="embed-responsive embed-responsive-16by9" style="box-sizing: border-box;">
            <div id="player"></div>
        </div>

    

@section Scripts{
    <script type="text/javascript">
        var ytVideoId = "";

        // 3. This function creates an <iframe> (and YouTube player)
        //    after the API code downloads.
        var player;

        function onYouTubeIframeAPIReady() {

            if (ytVideoId != "") {
                player = new YT.Player('player', {
                    height: '390',
                    width: '640',
                    videoId: ytVideoId,
                    events: {
                        'onReady': onPlayerReady,
                        'onStateChange': onPlayerStateChange
                    }
                });
            }

        }

        // 4. The API will call this function when the video player is ready.
        function onPlayerReady(event) {
            //event.target.playVideo();
        }

        // 5. The API calls this function when the player's state changes.
        //    The function indicates that when playing a video (state=1),
        //    the player should play for six seconds and then stop.
       // var done = false;
        function onPlayerStateChange(event) {
            //if (event.data == YT.PlayerState.PLAYING && !done) {
            //    setTimeout(stopVideo, 6000);
            //    done = true;
            //}
        }
        function stopVideo() {
            //player.stopVideo();
        }

        //JQuery
        $(document).ready(function () {
            $("#spiner").hide();


            $("#videoUrl").change(function () {
                // 2. This code loads the IFrame Player API code asynchronously.
                var tag = document.createElement('script');

                tag.src = "https://www.youtube.com/iframe_api";
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);


                var ytUrl = $("#videoUrl").val();
                var str= ytUrl.split("=");
                ytVideoId = str[1];

            });


            $("#btnDownload").click(function () {
                $("#spiner").show();
            });
        });
    </script>
}


